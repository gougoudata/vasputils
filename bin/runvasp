#! /usr/bin/env ruby
# coding: utf-8

require "rubygems"
gem "comana"
require "comana/computationmanager.rb"

#gem "vasputils"
require "vasputils/vaspdir.rb"
require "vasputils/vaspgeomopt.rb"

require "optparse"

## option analysis
OPTIONS = {}
op = OptionParser.new
op.on("-g"    , "--geom-opt", "Geometry optimization"){OPTIONS[:g] = true}
op.parse!(ARGV)

dir = ARGV[0] || "."

if OPTIONS[:g]
  calc_dir = VaspGeomOpt.new(dir)
else
  calc_dir = VaspDir.new(dir)
end

#pp calc_dir.class.ancestors

begin
  calc_dir.start
rescue ComputationManager::AlreadyStartedError
  puts "Already started. Exit."
  exit
end
