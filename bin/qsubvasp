#! /usr/bin/env ruby
# coding: utf-8

#require "optparse"
require "yaml"
require "pp"

require "rubygems"
gem "comana"
require "comana/queuesubmitter.rb"
#require "comana/machineinfo.rb"

require "vasputils/vaspdir.rb"
require "vasputils/vaspgeomopt.rb"


OPTS = QueueSubmitter.parse_options(
  ARGV, MachineInfo.load_file("#{ENV["HOME"]}/.machineinfo")
)
OPTS[:directory] = VaspGeomOpt.new(File.expand_path(ARGV[0]))
OPTS[:command] = "runvasp -g"
#pp OPTS; exit

qs = QueueSubmitter.new(OPTS)
#pp qs; exit
begin
  qs.start
  puts "Submitted. Exit."
  exit
rescue QueueSubmitter::AlreadyStartedError
  puts "Already started. Exit."
  exit
rescue QueueSubmitter::PrepareNextError
  puts "Must not happen."
  exit
end
